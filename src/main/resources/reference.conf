
web-echo {
  meta-info {
    // populated externally during the build
  }

  // ----------------------------------------------------------------
  // Application config

  application {
    name = "Web Echo"
    code = "web-echo"
  }

  http {
    listening-interface = "0.0.0.0"
    listening-interface = ${?WEB_ECHO_LISTEN_IP}
    listening-port = 8080
    listening-port = ${?WEB_ECHO_LISTEN_PORT}
  }

  site {
    # just a prefix word, no slashes
    prefix = ""
    prefix = ${?WEB_ECHO_PREFIX}
    # How the site is known remotely without any prefix and trailing /
    url = "http://127.0.0.1:8080"
    url = ${?WEB_ECHO_URL}
  }

  behavior {
    file-system-cache {
      path = "/tmp/web-echo-cache-data"
      path = ${?WEB_ECHO_STORE_PATH}
    }
    websockets-default-duration = 15m
    websockets-default-duration = ${?WEB_ECHO_WEBSOCKETS_DEFAULT_DURATION}
    websockets-max-duration = 4h
    websockets-max-duration = ${?WEB_ECHO_WEBSOCKETS_MAX_DURATION}
    # Defines the difficulty level for the Proof of Work (PoW) required when adding content.
    # A value of 0 means no PoW is required (default).
    # Higher values increase the difficulty and thus the time required to add content.
    # WARNING: Increasing this value will significantly slow down content addition!
    sha-goal = 0
    sha-goal = ${?WEB_ECHO_SHA_GOAL}
    storage-handle-ttl = 24h
    storage-handle-ttl = ${?WEB_ECHO_STORAGE_HANDLE_TTL}
    default-life-expectancy = 42m
    default-life-expectancy = ${?WEB_ECHO_DEFAULT_LIFE_EXPECTANCY}
    cleanup-interval = 10m
    cleanup-interval = ${?WEB_ECHO_CLEANUP_INTERVAL}
  }

  security {
    ssrf-protection-enabled = true
    ssrf-protection-enabled = ${?WEB_ECHO_SECURITY_SSRF_PROTECTION_ENABLED}

    keycloak {
      enabled = false
      enabled = ${?WEB_ECHO_SECURITY_KEYCLOAK_ENABLED}
      
      # The base URL of your Keycloak server, e.g., http://localhost:8080/auth or https://keycloak.example.com
      url = "http://localhost:8081"
      url = ${?WEB_ECHO_SECURITY_KEYCLOAK_URL}
      
      realm = "web-echo"
      realm = ${?WEB_ECHO_SECURITY_KEYCLOAK_REALM}
      
      strict-issuer-check = false
      strict-issuer-check = ${?WEB_ECHO_SECURITY_KEYCLOAK_STRICT_ISSUER_CHECK}
      
      # Optional: client-id / resource to verify against 'aud' or 'azp' claims
      resource = "web-echo"
      resource = ${?WEB_ECHO_SECURITY_KEYCLOAK_RESOURCE}
    }
  }

  // ----------------------------------------------------------------
  // pekko & pekko-http framework configuration
  // This configuration is used when this project is used as an app and not as a lib

  pekko {
    daemonic = off
    http {
      server {
        idle-timeout = 10s
        max-connections = 500
        remote-address-header = on
        remote-address-attribute = on
        user-agent-header = on
      }
      client {
        connecting-timeout = 10s
        idle-timeout = 10s
        parsing {
          max-header-count = 420
        }
      }
      routing {
        # Enables/disables ETag and `If-Modified-Since` support for FileAndResourceDirectives
        file-get-conditional = off
      }
      host-connection-pool {
        max-connections = 100
      }
    }
    loggers = ["org.apache.pekko.event.slf4j.Slf4jLogger"]
    loglevel = "INFO"
    logging-filter = "org.apache.pekko.event.slf4j.Slf4jLoggingFilter"
    log-dead-letters = 0
    log-dead-letters-during-shutdown = off
  }

}
